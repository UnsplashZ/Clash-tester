version: '3.8'

services:
  tester:
    build: .
    container_name: clash-tester-worker
    restart: unless-stopped
    environment:
      - SUB_URL=https://your-subscription-url.com/sub
      - INTERVAL=3600
      - TZ=Asia/Shanghai
    volumes:
      - ./data:/data
      # ⚠️ 关键：同步宿主机时间，防止节点鉴权失败
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    # ⚠️ 关键：使用公共 DNS，防止 Docker 内部 DNS 解析失败
    dns:
      - 223.5.5.5
      - 8.8.8.8

  server:
    image: nginx:alpine
    container_name: clash-tester-server
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./data:/usr/share/nginx/html:ro
    depends_on:
      - tester

# 如果上述配置依然无法联通，请注释掉上面的 networks/ports 配置，
# 并取消下面这一行的注释，使用 Host 网络模式（最强力）：
#   network_mode: host